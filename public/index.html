<!DOCTYPE html>
<html>
<head>
    <title>socket</title> 
    <script
    src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
    integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc="
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
<body>
    <div class="tweet">
        <h3>test</h3>
    </div>
    <ul id="list"></ul>

    <script src="./socket.io.js"></script>
    
    <script>
        var socket = io.connect("http://localhost:3000");
        var divs = [];
        var bitRowMap = new Array(20).fill(0);
        var divid = 0;
        var rowNum; 
        socket.on('tweet', function(data){
            // console.log(data);
            if (Math.random() > 0.97) {

                var div = document.createElement("div");
                div.setAttribute("id", divid = divid++ % 30);
      
                div.appendChild(document.createTextNode(data.message));
                
                do {
                    rowNum = (Math.round(Math.random() * 20));
                } while (bitRowMap[rowNum] == 1);

                div.style.top = Math.round(rowNum * 5)+ "%";
                bitRowMap[rowNum] = 1;
                divs.push((divid, rowNum));
                console.log(bitRowMap);

                div.style.left = (Math.round(Math.random() * 100)) + "%";
                $("body").append(div);
                
                while (divs.length > 30) {
                    var divRemoved = divs.shift();
                    $("#" + divRemoved[0]).remove();
                    bitRowMap[divRemoved[1]] = 0;
                }
            }
        });
    </script>

</body>
</html>